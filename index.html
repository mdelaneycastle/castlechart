<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Company Flow Chart.</title>
  <style>
   body {
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
}

#flowchart {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 40px; /* Add spacing between rows */
  margin-top: 20px;
}

.node {
  display: flex;
  flex-direction: column;
  align-items: center;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 8px;
  width: 150px;
  background-color: #f9f9f9;
  text-align: center;
  position: relative; /* Allows for absolute positioning of connectors */
}

.node img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
}

.children {
  display: flex;
  justify-content: center;
  gap: 40px; /* Increase spacing between sibling nodes */
  margin-top: 20px;
  position: relative;
}

.children::before {
  content: '';
  position: absolute;
  top: -20px;
  left: 50%;
  width: 1px;
  height: 20px;
  background-color: #ddd;
}

.node::before,
.node::after {
  content: '';
  position: absolute;
  top: 0;
  width: 1px;
  height: 20px;
  background-color: #ddd;
}

.node::before {
  left: 50%;
  transform: translateX(-50%);
}

.node::after {
  left: 50%;
  height: calc(100% - 20px);
}

.node:first-child::before,
.node:first-child::after {
  display: none; /* Remove lines for the top-level node */
}
  </style>
</head>
<body>
  <div id="flowchart"></div>

  <!-- Add New Person Modal -->
  <div id="addPersonModal" class="modal hidden">
    <form id="addPersonForm">
      <label>
        Name: <input type="text" id="personName" required>
      </label>
      <label>
        Title: <input type="text" id="personTitle" required>
      </label>
      <label>
        Boss ID (leave blank for top-level): <input type="text" id="personBossId">
      </label>
      <label>
        Photo URL: <input type="text" id="personPhoto" placeholder="Photo URL">
      </label>
      <button type="submit">Add</button>
      <button type="button" onclick="closeModal()">Cancel</button>
    </form>
  </div>

  <button onclick="openModal()">Add Person</button>

  <script>
  // JavaScript

  const flowchart = document.getElementById("flowchart");
  const modal = document.getElementById("addPersonModal");
  const form = document.getElementById("addPersonForm");

  let nodes = []; // Stores all people in a hierarchical structure

  // Open Modal
  function openModal() {
    modal.classList.remove("hidden");
  }

  // Close Modal
  function closeModal() {
    modal.classList.add("hidden");
  }

  // Recursive function to find a boss by ID in the hierarchy
  function findBossById(id, nodes) {
    for (let node of nodes) {
      if (node.id == id) {
        return node; // Found the boss
      }
      // Recursively search in children
      const foundInChildren = findBossById(id, node.children);
      if (foundInChildren) {
        return foundInChildren;
      }
    }
    return null; // Boss not found
  }

  // Add Person to the Flowchart
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const name = document.getElementById("personName").value;
    const title = document.getElementById("personTitle").value;
    const bossId = document.getElementById("personBossId").value || null;
    const photo = document.getElementById("personPhoto").value;

    const id = Date.now(); // Unique ID for each person

    const newPerson = { id, name, title, bossId, photo, children: [] };

    if (bossId) {
      // Use the recursive function to find the boss
      const boss = findBossById(bossId, nodes);
      if (boss) {
        boss.children.push(newPerson); // Add as child to the boss
      } else {
        alert("Boss ID not found. Adding person as top-level.");
        nodes.push(newPerson); // Add as a top-level node
      }
    } else {
      // If no boss, this person is a top-level node
      nodes.push(newPerson);
    }

    renderFlowchart();
    closeModal();
  });

  // Render Flowchart
  function renderFlowchart() {
    flowchart.innerHTML = ""; // Clear existing chart
    nodes.forEach((node) => {
      // Render each top-level node
      flowchart.appendChild(createNodeElement(node));
    });
  }

  // Create Node Element Recursively
  function createNodeElement(node) {
    const nodeElement = document.createElement("div");
    nodeElement.classList.add("node");

    nodeElement.innerHTML = `
      <img src="${node.photo}" alt="${node.name}">
      <h3>${node.name}</h3>
      <p>${node.title}</p>
      <p><strong>ID:</strong> ${node.id}</p>
    `;

    // Add children
    if (node.children.length > 0) {
      const childrenContainer = document.createElement("div");
      childrenContainer.classList.add("children");
      node.children.forEach((child) => {
        childrenContainer.appendChild(createNodeElement(child));
      });
      nodeElement.appendChild(childrenContainer);
    }

    return nodeElement;
  }

  // Initial Render
  renderFlowchart();
</script>
</body>
</html>
